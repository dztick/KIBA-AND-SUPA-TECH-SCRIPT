-- [KIBA TECH] berdasarkan hasil probe
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local root = char:WaitForChild("HumanoidRootPart")

-- Remote references
local DashRemote = ReplicatedStorage.Resources.Brother["#Friend"].Communicate
local CombatRemote = ReplicatedStorage.RemoteFunction

-- Toggle state
local kibaOn = false
local UserInputService = game:GetService("UserInputService")

-- Notif kecil di kanan bawah
local pg = player:WaitForChild("PlayerGui")
local gui = Instance.new("ScreenGui", pg); gui.ResetOnSpawn = false
local text = Instance.new("TextLabel", gui)
text.Size = UDim2.new(0,150,0,30)
text.Position = UDim2.new(1,-160,1,-50)
text.BackgroundTransparency = 0.3
text.BackgroundColor3 = Color3.fromRGB(20,20,20)
text.TextColor3 = Color3.fromRGB(0,255,0)
text.Font = Enum.Font.Code; text.TextSize = 16
text.Text = "[KIBA TECH] OFF"

-- Fungsi dash ke target terakhir
local lastTarget = nil
local lastHitTime = 0

local function doKibaDash()
    if not lastTarget or (tick()-lastHitTime > 7) then return end
    local targetRoot = lastTarget:FindFirstChild("HumanoidRootPart")
    if not targetRoot then return end

    -- arah dash ke musuh
    local dir = (targetRoot.Position - root.Position).Unit

    -- Fire dash
    DashRemote:FireServer("Dash", dir, 0.25)

    -- Langsung coba invoke M1 ke target juga
    CombatRemote:InvokeServer("M1", lastTarget)
end

-- Toggle Kiba Tech on R
UserInputService.InputBegan:Connect(function(input,gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.R then
        kibaOn = not kibaOn
        text.Text = "[KIBA TECH] " .. (kibaOn and "ON" or "OFF")
        text.TextColor3 = kibaOn and Color3.fromRGB(0,255,0) or Color3.fromRGB(255,0,0)
    end
end)

-- Dummy: deteksi target terakhir kena hit
-- (disini kamu bisa hubungkan ke remote damage supaya update lastTarget)
game:GetService("RunService").Heartbeat:Connect(function()
    if kibaOn then
        doKibaDash()
    end
end)
