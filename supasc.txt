-- [SUPA TECH FINAL] Last target hit + auto stay di atas musuh
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")

-- Remote dash
local DashRemote = ReplicatedStorage.Resources.Brother["#Friend"].Communicate

-- State
local enabled = false
local lastTarget = nil
local lastHitTime = 0
local maxLastHit = 7 -- target disimpan max 7 detik

-- GUI status
local pg = player:WaitForChild("PlayerGui")
local gui = Instance.new("ScreenGui", pg); gui.ResetOnSpawn = false
local text = Instance.new("TextLabel", gui)
text.Size = UDim2.new(0,150,0,30)
text.Position = UDim2.new(1,-160,1,-50)
text.BackgroundTransparency = 0.3
text.BackgroundColor3 = Color3.fromRGB(20,20,20)
text.TextColor3 = Color3.fromRGB(255,0,0)
text.Font = Enum.Font.Code
text.TextSize = 16
text.Text = "[SUPA TECH] OFF"

-- Fungsi dash
local function doSupaDash()
	if not enabled or not lastTarget then return end
	if tick() - lastHitTime > maxLastHit then return end

	local targetRoot = lastTarget:FindFirstChild("HumanoidRootPart")
	if not targetRoot then return end

	-- kirim dash ke server
	DashRemote:FireServer({
		[1] = { ["Dash"] = Enum.KeyCode.W, ["Key"] = Enum.KeyCode.Q, ["Goal"] = "KeyPress" }
	})

	-- setelah sedikit delay, hentikan velocity & kunci badan di atas musuh
	task.delay(0.15, function()
		if hrp and targetRoot and enabled then
			hrp.Velocity = Vector3.zero
			hrp.CFrame = CFrame.new(targetRoot.Position + Vector3.new(0,3,0), targetRoot.Position)
		end
	end)
end

-- Toggle pakai R
UIS.InputBegan:Connect(function(input,gp)
	if gp then return end
	if input.KeyCode == Enum.KeyCode.R then
		enabled = not enabled
		text.Text = "[SUPA TECH] " .. (enabled and "ON" or "OFF")
		text.TextColor3 = enabled and Color3.fromRGB(0,255,0) or Color3.fromRGB(255,0,0)

		if enabled then
			doSupaDash()
		end
	end
end)

-- Update last target saat kena hit (gunakan Communicate juga)
-- Catat: ini hook OnClientEvent simulasi, sesuaikan jika nama event beda
for _,r in ipairs(ReplicatedStorage:GetDescendants()) do
	if r:IsA("RemoteEvent") and r.Name == "Communicate" then
		r.OnClientEvent:Connect(function(action, target)
			-- kalau ada argumen target = musuh yang kena hit
			if target and target:IsA("Model") and target:FindFirstChild("Humanoid") then
				lastTarget = target
				lastHitTime = tick()
			end
		end)
	end
end
