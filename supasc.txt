-- [SUPA TECH FIXED] Dash Q tapi auto nempel ke musuh terakhir
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local DashRemote = ReplicatedStorage.Resources.Brother["#Friend"].Communicate

-- State
local enabled = false
local lastTarget = nil
local lastHitTime = 0
local maxLastHit = 2 -- detik

-- GUI status
local pg = player:WaitForChild("PlayerGui")
local gui = Instance.new("ScreenGui", pg); gui.ResetOnSpawn = false
local text = Instance.new("TextLabel", gui)
text.Size = UDim2.new(0,150,0,30)
text.Position = UDim2.new(1,-160,1,-50)
text.BackgroundTransparency = 0.3
text.BackgroundColor3 = Color3.fromRGB(20,20,20)
text.TextColor3 = Color3.fromRGB(255,0,0)
text.Font = Enum.Font.Code
text.TextSize = 16
text.Text = "[SUPA TECH] OFF"

-- Fungsi dash (Q)
local function doSupaDash(targetRoot)
    if not enabled or not targetRoot then return end
    DashRemote:FireServer({
        [1] = {
            ["Dash"] = Enum.KeyCode.W,
            ["Key"]  = Enum.KeyCode.Q,
            ["Goal"] = "KeyPress"
        }
    })
end

-- Heartbeat: kunci posisi supaya nempel di musuh
RunService.Heartbeat:Connect(function()
    if not enabled or not lastTarget then return end
    if tick() - lastHitTime > maxLastHit then return end

    local char = player.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    local targetRoot = lastTarget:FindFirstChild("HumanoidRootPart")
    if hrp and targetRoot then
        -- Paksa posisi kamu ke atas target biar gak kelewatan
        local offset = Vector3.new(0, 3, 0) -- 3 stud di atas musuh
        hrp.CFrame = CFrame.new(targetRoot.Position + offset, targetRoot.Position)
    end
end)

-- Toggle ON/OFF pakai R
UIS.InputBegan:Connect(function(input,gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.R then
        enabled = not enabled
        text.Text = "[SUPA TECH] " .. (enabled and "ON" or "OFF")
        text.TextColor3 = enabled and Color3.fromRGB(0,255,0) or Color3.fromRGB(255,0,0)

        if enabled and lastTarget then
            local targetRoot = lastTarget:FindFirstChild("HumanoidRootPart")
            doSupaDash(targetRoot)
        end
    end
end)

-- Contoh dummy: pilih target musuh terdekat
-- (nanti bisa diganti dengan “musuh terakhir kena hit”)
RunService.Heartbeat:Connect(function()
    if not enabled then return end
    local nearest, dist = nil, 12
    for _,p in ipairs(Players:GetPlayers()) do
        if p ~= player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            local d = (p.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
            if d < dist then
                nearest, dist = p.Character, d
            end
        end
    end
    if nearest then
        lastTarget = nearest
        lastHitTime = tick()
    end
end)
